{% extends 'menuAdministrador.html' %}
{% load static %}
{% block title %}Solicitudes De Pedidos{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.bootstrap5.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/3.0.5/css/responsive.bootstrap5.css">
<link rel="stylesheet" href="{% static 'css/tablaCliente.css'%}" />

<div class="container mt-5">
  <h2 class="text-center text-white mb-4"><i class="bi bi-clipboard2-check"></i>Gestionar Solicitudes De Pedidos</h2>
   
  <div class="table-responsive bg-white p-3 rounded shadow mb-2">
    <table id="tabla-pedidos" class="table table-striped table-bordered bg-white text-dark responsive">
      <thead class="table-light">
        <tr>
          <th class="text-center align-middle">Fecha</th>
          <th class="text-center align-middle">Descripción</th>
          <th class="text-center align-middle">Categoría</th>
          <th class="text-center align-middle">Estado</th>
          <th class="text-center align-middle">Comentario</th>
          <th class="text-center align-middle">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for servicio in servicios %}
        <tr>
            <td class="text-center align-middle">{{servicio.fecha_servicio|date:"d/m/Y"}}</td>
            <td class="text-center align-middle">
                <button class="btn btn-sm btn-descripcion text-white" style="background: #6C2DC7;"

                        data-bs-toggle="modal"
                        data-bs-target="#modalDescripcion"
                        data-descripcion="{{ servicio.descripcion_servicio }}">
                    Ver Descripción
                </button>
            </td>
            <td class="text-center align-middle">{{servicio.id_categoria_servicio.nombre_categoria_servicio}}</td>
            <td class="text-center align-middle">
                {% if servicio.estado_servicio == 'Re' %}
                <span class="badge bg-warning text-black">En Revisión</span>
                {% elif servicio.estado_servicio == 'Ac' %}
                <span class="badge bg-success">Aceptado</span>
                {% elif servicio.estado_servicio == 'Ca' %}
                <span class="badge bg-danger">Rechazado</span>
                {% endif %}
            </td>
            <td class="text-center align-middle">
                <button class="btn btn-sm btn-descripcion text-white" style="background: #6C2DC7;"
                        data-bs-toggle="modal"
                        data-bs-target="#modalDescripcion"
                        data-descripcion="{{ servicio.descripcion_servicio }}">
                    Añadir Comentario
                </button>
            </td>
            
            <!-- Nueva Columna Acciones -->
            <td class="text-center align-middle">
                {% if servicio.estado_servicio == 'Re' %}
                    <button class="btn btn-success btn-sm btn-accion" 
                        data-bs-toggle="modal"
                        data-bs-target="#modalGestionar"
                        data-id="{{ servicio.id_servicio }}"
                        data-accion="Ac">
                        Aceptar
                    </button>

                    <button class="btn btn-danger btn-sm btn-accion" 
                        data-bs-toggle="modal"
                        data-bs-target="#modalGestionar"
                        data-id="{{ servicio.id_servicio }}"
                        data-accion="Ca">
                        Rechazar
                    </button>
                {% else %}
                    <button class="btn btn-secondary btn-sm" disabled>Gestionado</button>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.3.2/js/dataTables.bootstrap5.js"></script>
<script src="https://cdn.datatables.net/responsive/3.0.5/js/dataTables.responsive.js"></script>
<script src="https://cdn.datatables.net/responsive/3.0.5/js/responsive.bootstrap5.js"></script>
<script src="{% static 'js/dataTablePedidos.js'%}"></script>
{% endblock %}
