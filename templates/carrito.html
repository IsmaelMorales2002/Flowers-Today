{% extends 'menu.html' %}
{% load static %}
{% block title %}Carrito{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/carrito.css' %}">
<section class="container my-5 text-white">
  <h2 class="mb-4 text-center" id="titulo-carrito"></h2>

  <div class="row g-4">
    <!-- Productos -->
    <div class="col-12 col-lg-8"  id="contenedor-productos">
     
    </div>

    <!-- Resumen -->
    <div class="col-12 col-lg-4" id="resumen-total" style="display: none;">
      <div class="card shadow-sm border-0" style="position: sticky; top: 20px;">
        <div class="card-body">
          <h5 class="card-title text-center">Resumen</h5>
          <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between border-0 border-bottom">
              <span>Total</span>
              <strong id="resumen-subtotal">${{ subtotal }}</strong>
            </li>
          </ul>
          <div class="d-grid gap-2">
            <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#modalFinalizarCompra">Finalizar compra</button>
            <a href="{% url 'vista_inicio_cliente' %}" class="btn btn-ms text-white" style="background: #6C2DC7;">Seguir comprando</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Modal -->
<div class="modal fade" id="modalFinalizarCompra" tabindex="-1" aria-labelledby="modalFinalizarCompraLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 rounded-4 shadow-lg">
      <div class="modal-header bg-dark text-white rounded-top-4">
        <h5 class="modal-title" id="modalFinalizarCompraLabel">Confirmar compra</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body text-center p-4">
        <form id="formFinalizarCompra" method="POST" action="{% url 'RealizarCompra' %}">{% csrf_token %}

          <p class="mb-3"><strong>¿Estás seguro de que deseas finalizar la compra?</strong></p>
          <p class="mb-4"><strong>Total a pagar: </strong> <strong id="modal-total">$0.00</strong></p>

          <input type="hidden" name="txtCorreo" value="{{request.session.correo_cliente}}">
          <input type="hidden" name="txtTotal" id="txtTotal" value="">
          <input type="hidden" name="productos[]" id="txtIdProducto" value="">
          <input type="hidden" name="cantidades[]" id="txtCantidad" value="">

          <div class="d-flex justify-content-center gap-3">
            <button type="submit" class="btn text-white" style="background: #6C2DC7;">Confirmar</button>
            <button type="button" class="btn btn-danger" data-bs-dismiss="modal" id="btn-cancelar-compra">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

{% if messages %}
  {% for message in messages %}
    {% if message.tags == 'warning' %}
      <!-- Modal de Advertencia -->
      <div class="modal fade" id="modalAdvertencia" tabindex="-1" aria-labelledby="modalAdvertenciaLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content border-0 rounded-4 shadow-lg">
            <div class="modal-header bg-dark text-white rounded-top-4">
              <h5 class="modal-title" id="modalAdvertenciaLabel">⚠ Producto Agotado
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body text-center p-4">
              <div class="alert alert-warning d-flex align-items-center justify-content-center" role="alert">
                <svg class="bi flex-shrink-0 me-2" width="20" height="20" fill="currentColor" role="img" aria-label="Warning:">
                  <use xlink:href="#exclamation-triangle-fill"/>
                </svg>
                <div> <strong> {{ message }} </strong> </div>
              </div>
              <span class="mt-3">¿Deseas continuar comprando solo los productos disponibles?</span>

              <div class="d-flex justify-content-center gap-3 mt-4">
                <button type="button" id="btnContinuarAdvertencia" class="btn text-white" style="background: #6C2DC7;">Continuar</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancelar</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <script>
        document.addEventListener('DOMContentLoaded', function() {
          var modal = new bootstrap.Modal(document.getElementById('modalAdvertencia'));
          modal.show();
          document.getElementById('btnContinuarAdvertencia').addEventListener('click', () =>{
          modal.hide();          
          document.getElementById('formFinalizarCompra').submit()
        })
        });
      </script>
    {% endif %}
  {% endfor %}
{% endif %}


<svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check-circle-fill" viewBox="0 0 16 16">
    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
  </symbol>
  <symbol id="info-fill" viewBox="0 0 16 16">
    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
  </symbol>
  <symbol id="exclamation-triangle-fill" viewBox="0 0 16 16">
    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
  </symbol>
</svg>



<script src="{% static 'js/productos.carrito.js'%}"></script>
{% endblock %}
